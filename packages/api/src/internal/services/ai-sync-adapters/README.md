# AI Sync Adapters

Synchronizes AI models from multiple providers (OpenAI, Google, Anthropic, xAI) with unified pricing management.

## 🚀 Quick Start

**Need to sync models fast?** → **[How-To-Sync.md](./How-To-Sync.md)** - 3-step fast reference guide

**Want to update pricing?** → **[update/pricing-ai-script.md](./update/pricing-ai-script.md)** - AI pricing update script

**Want to understand the system?** → Continue reading this README for complete documentation

## 📁 File Structure

```info
ai-sync-adapters/
├── README.md                    # This file - complete documentation
├── How-To-Sync.md              # ⚡ Fast sync reference guide
├── supported-providers.json     # 👤 Manual: Provider configuration
├── supported-models.json        # 👤 Manual: Curated model list
├── synced-models.json           # 🤖 Auto: Generated unified model data
├── synced-price.json            # 🤖 Auto: Pricing sync status report
├── update/
│   ├── models-sync-provider.dev.ts  # Model sync script
│   └── pricing-ai-script.md     # 👤 Manual: AI pricing update guide
└── providers/
    ├── openai/
    │   ├── openai-adapter.ts        # Provider adapter
    │   ├── openai-pricing.md        # 👤 Manual: Pricing documentation
    │   ├── openai-pricing.json      # 👤 Manual: Pricing configuration
    │   ├── openai-models.json       # 🤖 Auto: Technical specs
    │   └── openai-models-summary.json # 🤖 Auto: Model IDs only
    ├── google/
    │   ├── google-adapter.ts         # Provider adapter
    │   ├── google-pricing.md         # 👤 Manual: Pricing documentation
    │   ├── google-pricing.json       # 👤 Manual: Pricing configuration
    │   ├── google-models.json        # 🤖 Auto: Technical specs
    │   └── google-models-summary.json # 🤖 Auto: Model IDs only
    ├── anthropic/
    │   ├── anthropic-adapter.ts      # Provider adapter
    │   ├── anthropic-pricing.md      # 👤 Manual: Pricing documentation
    │   ├── anthropic-pricing.json    # 👤 Manual: Pricing configuration
    │   ├── anthropic-models.json     # 🤖 Auto: Technical specs
    │   └── anthropic-models-summary.json # 🤖 Auto: Model IDs only
    └── xai/
        ├── xai-adapter.ts           # Provider adapter
        ├── xai-pricing.md           # 👤 Manual: Pricing documentation
        ├── xai-pricing.json         # 👤 Manual: Pricing configuration
        ├── xai-models.json          # 🤖 Auto: Technical specs
        └── xai-models-summary.json  # 🤖 Auto: Model IDs only
```

**Legend:**
- 👤 **Manual**: Files you edit manually
- 🤖 **Auto**: Files generated by sync scripts

## 🔄 How to Sync

### Two Types of Syncing

#### 1. Model Sync (Technical Data)
Syncs model specifications and technical details from provider APIs:

```bash
pnpm run --filter @kdx/api models-sync
```

**What it does**:
- Fetches latest models from each provider's API
- Updates `[provider]-models.json` with technical specifications
- Updates `[provider]-models-summary.json` with model IDs
- Generates unified `synced-models.json` with pricing applied
- Only syncs models listed in `supported-models.json`

#### 2. Pricing Sync (Business Data)
Updates pricing information based on official provider pricing pages:

```bash
# Follow the AI script instructions:
# See: update/pricing-ai-script.md
```

**What it does**:
- Updates `[provider]-pricing.json` files based on official pricing
- Creates `synced-price.json` status report
- Ensures all models have current pricing information

## 📋 Configuration Files

### Files You Must Configure Manually

#### `supported-providers.json`
**Purpose**: Defines which AI providers to sync from.
**You must**: Add/remove providers manually.

```json
{
  "providers": [
    {
      "name": "OpenAI",
      "base_url": "https://api.openai.com",
      "sync_name": "openai"
    },
    {
      "name": "Google", 
      "base_url": "https://generativelanguage.googleapis.com",
      "sync_name": "google"
    }
  ]
}
```

#### `supported-models.json`
**Purpose**: Curated list of models to include in the platform.
**You must**: Add new models manually when they become available.

```json
[
  {"modelId": "gpt-4o"},
  {"modelId": "gpt-4o-mini"},
  {"modelId": "claude-3-5-sonnet-20241022"},
  {"modelId": "gemini-1.5-pro"}
]
```

⚠️ **Important**: Only models in this list will be synced and available in the platform.

### Files Generated Automatically

#### `synced-models.json`
**Purpose**: Unified model data with pricing applied.
**Generated by**: `pnpm run --filter @kdx/api models-sync`

Contains complete model information:
- Technical specifications from provider APIs
- Pricing from `[provider]-pricing.json` files
- Only includes models from `supported-models.json`

#### `synced-price.json`
**Purpose**: Status report of last pricing sync.
**Generated by**: Following `update/pricing-ai-script.md`

```json
{
  "lastSyncDate": "2025-07-15 03:30:00",
  "providers": [
    {
      "provider": "openai",
      "syncDate": "2025-07-15 03:30:00", 
      "status": "success",
      "modelsUpdated": 19,
      "notes": "Added pricing for gpt-4o-mini, o1-preview..."
    }
  ]
}
```

## 🎯 Complete Sync Workflow

### Step 1: Configure Base Files (Manual)
1. Update `supported-providers.json` with desired providers
2. Update `supported-models.json` with models you want to support
3. Ensure API keys are set in root `.env` file:
   ```bash
   OPENAI_API_KEY=sk-...
   GOOGLE_API_KEY=AIza...
   ANTHROPIC_API_KEY=sk-ant-...
   XAI_API_KEY=xai-...
   ```

### Step 2: Update Pricing (Manual - AI Assisted)
Follow the AI script: `update/pricing-ai-script.md`

This will:
- Update all `providers/[provider]/[provider]-pricing.json` files
- Create `synced-price.json` status report

### Step 3: Sync Models (Automated)
```bash
pnpm run --filter @kdx/api models-sync
```

This will:
- Fetch latest model data from provider APIs
- Apply pricing from pricing JSON files
- Generate unified `synced-models.json`
- Update individual provider model files

### Step 4: Verify and Test
1. Check `synced-models.json` contains expected models with pricing
2. Test in AI Studio UI to ensure models appear correctly
3. Build API if needed: `pnpm build --filter @kdx/api`

## 🔧 Pricing System

### Provider-Specific Pricing Files
Each provider has a manually configured pricing file:

```json
[
  {
    "modelId": "exact-model-id-from-api",
    "pricing": {
      "input": "2.50",
      "output": "10.00", 
      "unit": "per_million_tokens"
    }
  }
]
```

**Important**: 
- Model IDs must match exactly what the provider API returns
- Prices must be strings (e.g., "2.50" not 2.50)
- Unit must always be "per_million_tokens"

### Pricing Update Process
Use the AI script in `update/pricing-ai-script.md`:

1. Reads provider pricing documentation
2. Visits official pricing pages  
3. Updates pricing JSON files
4. Creates sync status report

**Fallback**: If no pricing is found, defaults to $1.00 input / $3.00 output per million tokens.

## 🔧 Troubleshooting

### Model sync fails
- Check API keys in root `.env` file
- Verify provider URLs in `supported-providers.json`
- Check network connectivity
- Ensure provider has credits/quota available

### Missing models
- Ensure model is listed in `supported-models.json`
- Check if API key has correct permissions
- Verify model is available in provider's API
- Check console output for errors

### Missing pricing
- Ensure model has pricing in `providers/[provider]/[provider]-pricing.json`
- Run pricing update using `update/pricing-ai-script.md`
- Check that model ID matches exactly between pricing file and API

### Pricing discrepancies
- Use AI script to update pricing from official sources
- Verify model IDs match exactly
- Check `synced-price.json` for last update status

## 🚀 Advanced Usage

### Adding a New Provider
1. Follow `providers/ADD-NEW-PROVIDER-GUIDE.md`
2. Add to `supported-providers.json`
3. Create provider folder with adapter and pricing files
4. Test sync process

### Adding New Models
1. Add model ID to `supported-models.json`
2. Update provider's pricing file if needed
3. Run model sync to fetch technical specs
4. Verify model appears in `synced-models.json`

### Custom Pricing Overrides
Edit `synced-models.json` manually after sync (will be overwritten on next sync):

```json
{
  "modelId": "custom-model",
  "name": "Custom Model", 
  "provider": "openai",
  "pricing": {
    "input": "5.00",
    "output": "15.00",
    "unit": "per_million_tokens"
  }
}
```

## 📋 Validation Checklist

After sync completion:

- [ ] `synced-models.json` exists with pricing for all supported models
- [ ] `synced-price.json` shows successful pricing sync
- [ ] Provider model files contain technical specs
- [ ] All models from `supported-models.json` appear in unified data
- [ ] Pricing appears correctly in AI Studio UI
- [ ] Model sync completed without errors

---

**Architecture Summary:**

- **Configuration**: Manual files control what gets synced
- **Model Data**: Automated fetch from provider APIs
- **Pricing**: Manual configuration with AI-assisted updates
- **Output**: Unified JSON files for platform consumption